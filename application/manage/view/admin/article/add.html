{extend name="$_admin_base_layout" /}

{block name="plugins-css"}
<link href="__LIBS__/jquery-nestable/jquery.nestable.css" rel="stylesheet" type="text/css" />
{/block}

{block name="content"}
<link href="__ADMIN_CSS__/all.css" rel="stylesheet" type="text/css" />
<script src="__ADMIN_JS__/ajaxfileupload.js"></script>
<script src="__LIBS__/bootstrap-datepicker/bootstrap-datepicker.js"></script> 
<script type="text/javascript" charset="utf-8" src="__LIBS__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__LIBS__/ueditor/ueditor.all.min.js"></script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="__LIBS__/ueditor/lang/zh-cn/zh-cn.js"></script>
<style>#editor{float: left;max-width:70%;}</style>
<form id="add_form">

<div class="add_edit">
    <div class="con">
        <ul>
            <li>
                <span class="latips"><span class="required">*</span>文章标题：</span>
                <input type="text" name="title" value="" placeholder="请输入文章标题">
                <span class="bztips">长度不超过40个字</span>
            </li>
            <li>
                <span class="latips"><span class="required">*</span>作者：</span>
                <input type="text" name="writer" value="" placeholder="请输入作者">
                <span class="bztips">长度不超过8个字</span>
            </li>
            <li>
                <span class="latips">发布日期：</span>
                <input type="text" name="ground_at" value="" placeholder="请选择日期" style="width: 11%;min-width: 95px;" class="timepick">
                <span class="bztips">不选择默认提交时间</span>
            </li>
            <li>
                <span class="latips"><span class="required">*</span>下架日期：</span>
                <input type="text" name="lower_at" value="" placeholder="请选择日期" style="width: 11%;min-width: 95px;" class="timepick">
                <span class="bztips">必须大于发布时间</span>
            </li>
            <li>
                <span class="latips" id="editor_latips" style="float: left;">正文：</span>
                <textarea name="content" id="editor"></textarea> 
                <span class="bztips" id="editor_bztips" style="display: block;clear: both;">长度不超过3000个字</span>
            </li>
        </ul>
        <div style="clear: both;"></div>
    </div>
</div>


<div style="margin: 40px auto;text-align: center;">
    <a href="javascript:;" class="btn btn-minw btn-primary rbt" id="add_form_submit">确&nbsp;定</a>
</div>

</form>

<form style="display: none;" id='up_one_form' enctype="multipart/form-data"><input type="file" name="file" id="up_one_form_in" ralate="" suffix="" msize=""></form>

<script>
var editor = new UE.ui.Editor(); 
UE.getEditor('editor',{
    initialFrameHeight:800,//设置编辑器高度
});   
UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;   
UE.Editor.prototype.getActionUrl = function(action) {  
    if (action == 'uploadimage' || action == 'uploadscrawl' || action == 'uploadvideo' || action == 'uploadfile') {  
        return '{:url("index/file/ueditorupload")}';//这就是自定义的上传地址  
    }  else {  
        return this._bkGetActionUrl.call(this, action);  
    }  
}  
</script>
<script>
    $('#editor_bztips').css('marginLeft',($('#editor_latips').width()-10)+'px');
    $(function(){
        //提交
        $('#add_form_submit').click(function(){
            Dolphin.loading();
            $.ajax({
                type:'post',
                url:'{:url("manage/article/add")}',
                data:$('#add_form').serializeArray(),
                dataType:'JSON',
                success:function(data){
                    Dolphin.loading('hide');
                    if (data.code==200) {
                        Dolphin.notify(data.msg, 'success');
                        setTimeout(function () {
                            location.href = '{:url("manage/article/add")}';
                        }, 1500);
                    } else {
                        Dolphin.notify(data.msg, 'danger');
                    }
                },
                error:function(xhr,status,error){
                    Dolphin.loading('hide');
                    Dolphin.notify('服务器错误~', 'danger');
                }
            });
        });
    });
</script>

<script>
    
</script>

<script src="__ADMIN_JS__/specil.js"></script>
{/block}

{block name="script"}
<script src="__LIBS__/jstree/jstree.min.js"></script>
<script src="__LIBS__/jquery-nestable/jquery.nestable.js"></script>
<script src="__LIBS__/jquery-ui/jquery-ui.min.js"></script>
<script src="__ADMIN_JS__/food.js"></script>
{/block}